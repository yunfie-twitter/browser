events {}

http {
    # Docker 用 DNS resolver
    resolver 127.0.0.11 ipv6=off;

    server {
        listen 80;
        server_name _;

        location / {
            proxy_pass https://puter.surf;

            # HTTPS upstream 用
            proxy_ssl_server_name on;

            # 正しい Host
            proxy_set_header Host puter.surf;

            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # upstream の iframe ブロックを消す
            proxy_hide_header X-Frame-Options;
            proxy_hide_header Content-Security-Policy;

            # iframe 埋め込み許可
            add_header Content-Security-Policy "frame-ancestors *" always;
        }
    }
}
